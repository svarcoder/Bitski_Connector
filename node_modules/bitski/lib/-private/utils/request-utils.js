"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseResponse = void 0;
const bitski_provider_1 = require("bitski-provider");
const parse_error_1 = require("../errors/parse-error");
/**
 * Parses a Fetch Response to extract either the result or the error
 * @param response the fetch response to parse
 */
function parseResponse(response) {
    return response
        .json()
        .catch(() => {
        throw parse_error_1.ParseError.InvalidJSON();
    })
        .then((json) => {
        if (response.status >= 200 && response.status < 300) {
            return json;
        }
        else {
            if (json && json.error && json.error.message) {
                throw new bitski_provider_1.ServerError(json.error.message, response.status, response.url);
            }
            else if (json && json.error) {
                throw new bitski_provider_1.ServerError(json.error, response.status, response.url);
            }
            else {
                throw parse_error_1.ParseError.UnknownError();
            }
        }
    });
}
exports.parseResponse = parseResponse;
//# sourceMappingURL=request-utils.js.map